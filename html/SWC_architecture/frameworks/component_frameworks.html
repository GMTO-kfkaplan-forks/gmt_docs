

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>5. Frameworks &mdash; GMT Software And Controls documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/additional_style.css" type="text/css" />
  

  

  
    <link rel="top" title="GMT Software And Controls documentation" href="../../index.html"/>
        <link rel="up" title="Architecture and Design" href="../index.html"/>
        <link rel="next" title="6. Platform" href="../platform/platform.html"/>
        <link rel="prev" title="4. Observatory Services" href="../services/observatory_services.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> GMT Software And Controls
          

          
            
            <img src="../../_static/logowhite.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../release_notes/index.html">Release Notes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Architecture and Design</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction/swcs_introduction.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture/overall_architecture.html">2. Overall Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tcs/tcs_introduction.html">3. Telescope Control System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services/observatory_services.html">4. Observatory Services</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">5. Frameworks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#domain-engineering">5.1. Domain Engineering</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#process">5.1.1. <em>Process</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="#quantitative-results">5.1.2. <em>Quantitative Results</em></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#framework-usage-code-generation">5.2. Framework Usage / Code Generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#core-framework">5.3. Core Framework</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#distributed-communication">5.3.1. <em>Distributed Communication</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="#framework-implementation">5.3.2. <em>Framework Implementation</em></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#device-control-framework">5.4. Device Control Framework</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#controller-state-machine">5.4.1. <em>Controller State Machine</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="#supervisors">5.4.2. <em>Supervisors</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="#device-controller-library">5.4.3. <em>Device Controller Library</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="#device-control-subsystem-deployment">5.4.4. <em>Device Control Subsystem Deployment</em></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#persistence-framework">5.5. Persistence Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-processing-framework">5.6. Data Processing Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="#time-distribution-framework">5.7. Time Distribution Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="#user-interface-framework">5.8. User Interface Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="#i-o-framework">5.9. I/O Framework</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#terminology">5.9.1. <em>Terminology</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="#fieldbus-communication">5.9.2. <em>Fieldbus Communication</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="#i-o-module-terminals">5.9.3. <em>I/O Module Terminals</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="#process-image">5.9.4. <em>Process Image</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="#bootstrap-process">5.9.5. <em>Bootstrap Process</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="#runtime-components">5.9.6. <em>Runtime Components</em></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../platform/platform.html">6. Platform</a></li>
<li class="toctree-l2"><a class="reference internal" href="../process/process_introduction.html">7. Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../risks/risks.html">8. Software and Control Risks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bibliography/bibliography.html">9. Bibliography</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../SWC_standards/index.html">Software and Controls Standards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software_development/index.html">Software Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data_products/index.html">Data Products</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/swc_sys_glossary.html">Software and Controls Acronyms and Definitions</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">GMT Software And Controls</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Architecture and Design</a> &raquo;</li>
      
    <li>5. Frameworks</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="frameworks">
<span id="component-frameworks"></span><h1>5. Frameworks<a class="headerlink" href="#frameworks" title="Permalink to this headline">¶</a></h1>
<p>Frameworks provide a collection of reusable building blocks that solve recurrent
problems in specialized domains (e.g., control systems, distributed services,
data processing, hardware interfaces) and facilitate developing observatory
applications. At the same time, they provide an isolation mechanism from
underlying software layers. The use of these component frameworks is key to
building a cost effective system <a class="reference internal" href="../bibliography/bibliography.html#youn10" id="id1">[Youn10]</a> and provides the following benefits:</p>
<blockquote>
<div><ul class="simple">
<li>Improved internal reuse. The design of the component frameworks is based on
set of recurrent design patterns <a class="reference internal" href="../bibliography/bibliography.html#gamm94" id="id2">[Gamm94]</a> (e.g., Controller, Pipeline,
Panel, Workflow, Sequence, Wrapper). A set of base classes implements
these design patterns by means of composition/delegation or specialization.</li>
<li>Improved consistency of designs and compliance with standards.</li>
<li>Improved robustness. Components that are reused in multiple scenarios and
different Subsystems are tested in more diverse conditions.</li>
<li>Reduced maintenance cost, since knowing about fewer types of Components is
required.</li>
<li>Improved external reuse. Component frameworks implement wrappers for
external software packages. Wrappers help reduce dependencies between
subsystem implementation code and external software packages and minimize
the propagation of changes through interfaces.</li>
</ul>
</div></blockquote>
<p>Frameworks have key distinguishing features compared to normal libraries:</p>
<blockquote>
<div><ul class="simple">
<li>Inversion of control. In a framework, unlike libraries or normal user
applications, the overall program’s flow of control is not dictated by the
caller, but by the framework.</li>
<li>Extensibility. A framework can be extended by the user usually by selective
overriding or specialized by user code to provide specific functionality.</li>
<li>Non-modifiable framework code. The framework code, in general, should not be
modified, except regarding extensibility. Users can extend the framework,
but cannot change its code.</li>
</ul>
</div></blockquote>
<p>This section presents the design of the GMT common frameworks, from the domain
engineering process to identify common building blocks, to the design and
intended usage of each individual framework.</p>
<div class="section" id="domain-engineering">
<span id="framework-domain-engineering"></span><h2>5.1. Domain Engineering<a class="headerlink" href="#domain-engineering" title="Permalink to this headline">¶</a></h2>
<div class="section" id="process">
<h3>5.1.1. <em>Process</em><a class="headerlink" href="#process" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>The Domain Engineering Process is one of the Software Reuse Processes as
defined in ISO/IEC 12207 <a class="reference internal" href="../bibliography/bibliography.html#iso12207" id="id3">[ISO12207]</a>. As stated in the standard, domain
engineering is a reuse-based approach to defining the scope (i.e., domain
definition), specifying the structure (i.e., domain architecture), and
building the assets (e.g., requirements, designs, software code,
documentation) for a class of systems, subsystems or applications.</p>
<p>The Reuse Asset Management Process and the Reuse Program Management Process
complete the Software Reuses Processes. In the case of the GMT SWCS reuse assets
are implemented as component frameworks and specification files that capture
domain specific architectures and as a library of reusable components. All of
them are available in the GMT Software Repository.</p>
<p>A domain defines a set of common requirements, terminology and functionality for
any software program constructed to address a particular category of problems.
In software engineering, domain analysis, or product line analysis, is the
process of analyzing related software systems in a domain to find their common
and variable parts. The GMT domain analysis process creates a set of domain
object-oriented models using domain specific languages (DSL) <a class="reference internal" href="../bibliography/bibliography.html#fowl10" id="id4">[Fowl10]</a>.</p>
<p>Software developers can use these models as a basis for the implementation of
the SWCS subsystems architectures and applications. This approach to domain
analysis is also called model- driven engineering. Model-driven engineering
(MDE)* is a software development methodology that focuses on creating and
exploiting domain models (that is, abstract representation of the knowledge and
activities that govern a particular application domain).</p>
<p>The MDE approach is meant to increase productivity by maximizing compatibility
between systems (via reuse of standardized models), simplifying the process of
design (via models of recurring design patterns in the application domain), and
promoting communication between individuals and teams working on the system (via
standardization of the terminology and the best practices used in the
application domain).</p>
<p>The domain model is created in order to represent the vocabulary and key
concepts of the problem domain. It also identifies the relationships among all
the entities within the scope of the problem domain. In the SWCS the domain
model is captured as a set of System Definition Files (SDF) written in a DSL.
SDFs are text files that capture the specification of a Subsystem, Package or
Component.</p>
</div></blockquote>
</div>
<div class="section" id="quantitative-results">
<h3>5.1.2. <em>Quantitative Results</em><a class="headerlink" href="#quantitative-results" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>As described in the previous section, the software necessary to operate and
control an observatory can be modeled and explained using a set of essential
concepts that spans several domains of knowledge (e.g., observatory operation,
device control, data processing, process sequencing, and hardware I/O). The
results from the domain engineering process have been used to identify the
categories and number of components in each SWCS subsystems. Where a large
number of components of the same category has to be developed, a framework takes
care of providing the implementation of a reference architecture and a set of
common base components that are ready for use.</p>
<table border="1" class="docutils" id="id18">
<caption><span class="caption-number">Table 18 </span><span class="caption-text">Most Frequent Component Categories</span><a class="headerlink" href="#id18" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="50%" />
<col width="23%" />
<col width="28%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Component Category</th>
<th class="head">Classes</th>
<th class="head">Instances</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Controller</td>
<td>225</td>
<td>6665</td>
</tr>
<tr class="row-odd"><td>Pipeline</td>
<td>133</td>
<td>139</td>
</tr>
<tr class="row-even"><td>Server</td>
<td>75</td>
<td>75</td>
</tr>
<tr class="row-odd"><td>Panel</td>
<td>298</td>
<td>302</td>
</tr>
</tbody>
</table>
<p>The above table shows the distribution of Component classes found during the
domain analysis process. The first column of the table names the most common
components. The second column identifies the number of different classes found
for each component. The classes define the number of different behaviors and
interface specifications (e.g., <em>m1_support_act_ctrl</em>). The third column lists
the number of individual component instances. This is relevant as the number
of instances defines the number of different configurations for each class;
enables one to estimate the amount of telemetry data generated; and gives a
measurement of the effort necessary for assembly, integration and testing, as
each instance has to go through those processes individually.</p>
<p>The following list summarizes the list of common frameworks, while the next
sections describes them in more detail:</p>
<blockquote>
<div><ul class="simple">
<li><em>Core Framework</em> - Provides support for the development of a distribute
component system with an interface to the observatory services that is
independent of how these are implemented.</li>
<li><em>Device Control Framework</em> - Provides support for the development of
real-time and non- real time device control applications.</li>
<li><em>Persistence Framework</em> - Provides support for the persistent storage of data
structures and files.</li>
<li><em>Data Processing Framework</em> - Provides support for the development of data
processing applications.</li>
<li><em>Time Distribution Framework</em> - Allows applications to obtain absolute
time, set up timers and run synchronous tasks.</li>
<li><em>User Interface Framework</em> - Provides a set of common graphical components
and widgets for the development of graphic components. The use of the
framework ensures look and feel consistency between different subsystems.</li>
<li><em>Device Driver Framework</em> - Provides support for the development of
hardware device drivers. The implementation of a driver that allows
communicating with EtherCAT I/O modules is included in the framework.</li>
</ul>
</div></blockquote>
<table border="1" class="docutils" id="id19">
<caption><span class="caption-number">Table 19 </span><span class="caption-text">Overview of Analysis Domains</span><a class="headerlink" href="#id19" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="26%" />
<col width="27%" />
<col width="19%" />
<col width="27%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Analysis Domains</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Subsystem Packages</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Domain Entities</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Frameworks</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Control and Data</div>
<div class="line">Acquisition</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Device Controller Package</div>
<div class="line">Hardware Package</div>
<div class="line">Data Acquisition Package</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Controller</div>
<div class="line">Supervisor</div>
<div class="line">Fieldbus</div>
<div class="line">IOModule</div>
<div class="line">Device</div>
<div class="line">Pipeline</div>
<div class="line">Host</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Device Control Framework</div>
<div class="line">IO Framework</div>
<div class="line">Core Framework</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Operation Support</div>
<div class="line">Domain</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Services Package</div>
<div class="line">Sequencing Package</div>
<div class="line">Diagnosis Package</div>
<div class="line">Calibration Package</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Workflow</div>
<div class="line">Sequence</div>
<div class="line">Pipeline</div>
<div class="line">Server</div>
<div class="line">Program</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Data Processing Framework</div>
<div class="line">Device Control Framework</div>
<div class="line">Core framework</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Data Processing Domain</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Data Processing Package</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Sequence</div>
<div class="line">Pipeline</div>
<div class="line">Filter</div>
<div class="line">Workflow</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Data Processing</div>
<div class="line">Framework</div>
<div class="line">Storage Framework</div>
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Visualization Domain</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Visualzation Package</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Panel</div>
<div class="line">Widget</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">UI Framework</div>
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Safety Domain</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Safety Package</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Controller</div>
<div class="line">Supervisor</div>
<div class="line">Sequence</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Device Control Framework</div>
<div class="line">Core Framework</div>
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Management Domain</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Management Package</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Plan</div>
<div class="line">Iteration</div>
</div>
</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
<p>The above table shows the different domains identified in the GMT SWC domain
analysis activity. The first column identifies the studied domain. The column
Subsystem Packages identifies the software packages inside a subsystem that have
components related to the domain. The column Domain Entities list the main
domain entities used in the reference architecture of the domain model. Finally
the column named Frameworks lists the frameworks that facilitate developing
application components in the corresponding subsystem packages.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="framework-usage-code-generation">
<span id="framework-code-generation"></span><h2>5.2. Framework Usage / Code Generation<a class="headerlink" href="#framework-usage-code-generation" title="Permalink to this headline">¶</a></h2>
<p>GMT frameworks are intended to be extensible by specializing a set of base
classes. A set of tools provides the capability to generate the skeleton of a
component implementation from the specification of its interface.  <a class="reference internal" href="#figure-code-generation"><span class="std std-ref">The
Figure below (Component Skeleton Generation)</span></a> shows the
relation between generated skeletons and the GMT modeling framework.</p>
<p>The skeleton generation tools are available for every layer of the modeling
framework, i.e. they can generate the skeleton of a model element from the
metamodel or generate the skeleton of a runtime component from the model
specification.</p>
<div class="figure" id="id20">
<span id="figure-code-generation"></span><img alt="../../_images/component-skeleton-generation.png" src="../../_images/component-skeleton-generation.png" />
<p class="caption"><span class="caption-number">Fig. 42 </span><span class="caption-text">Component Skeleton Generation.  The GMT modeling framework is based in the
<a class="reference external" href="http://www.omg.org/mof/">OMG Meta Object Facility specification</a>. The
group on the left shows the main entities in the layered modeling
architecture. A set of modular plugins allows one to generate skeletons and
instances from layer to layer. The gen_skeleton function (1) allows the
generation of the skeleton of a model element. The gen_instance function (2)
allows the capability to generate the skeleton of an instance of a model
element. Instances are created in the next model layer and they inherit the
behavior of some of the framework base classes.</span></p>
</div>
<p>The table below describes three common framework use cases and the functionality
provided by the frameworks involved.</p>
<table border="1" class="docutils" id="id21">
<caption><span class="caption-number">Table 20 </span><span class="caption-text">Framework Typical Use Cases</span><a class="headerlink" href="#id21" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="18%" />
<col width="21%" />
<col width="27%" />
<col width="34%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Use Case</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Framework</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Base Classes</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Function</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Create a new</div>
<div class="line">Controller</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Core Framework</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Base Component</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Provides access to</div>
<div class="line">observatory services</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td><div class="first last line-block">
<div class="line">Device Control</div>
<div class="line">Framework</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">BaseDeviceController</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Provides usable control</div>
<div class="line">building blocks</div>
</div>
</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td><div class="first last line-block">
<div class="line">I/O Framework</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">IOModule, Device</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Provides access to the</div>
<div class="line">hardware</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Create a new</div>
<div class="line">Pipeline</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Core Framework</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">BaseComponent</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Provides access to the</div>
<div class="line">observatory services</div>
</div>
</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td><div class="first last line-block">
<div class="line">Data Processing</div>
<div class="line">Framework</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Pipeline, Filter,</div>
<div class="line">Recipe</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Defines a reference</div>
<div class="line">architecture for data</div>
<div class="line">processing pipelines</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td><div class="first last line-block">
<div class="line">Persistence</div>
<div class="line">Framework</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ObjectStore,</div>
<div class="line">FileStore</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Provides persistence to</div>
<div class="line">files and data structures</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Create a new</div>
<div class="line">Panel</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Core Framework</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">BaseComponent</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Provides access to</div>
<div class="line">Observatory Services</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td><div class="first last line-block">
<div class="line">UI Framework</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Panel, Widget</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Provides reusable</div>
<div class="line">visualization components</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="core-framework">
<span id="id5"></span><h2>5.3. Core Framework<a class="headerlink" href="#core-framework" title="Permalink to this headline">¶</a></h2>
<p>The GMT SWCS architecture is based on a distributed component design.
Distributed Components have been used in the design of different telescope
projects like GTC, ALMA, ATST <a class="reference internal" href="../bibliography/bibliography.html#cuhw13" id="id6">[CuHW13]</a> and is considered by next generation
projects <a class="reference internal" href="../bibliography/bibliography.html#kakd11" id="id7">[KaKD11]</a>.  In the past, this architecture has been implemented using
object-oriented middleware, most commonly based on the <a class="reference external" href="http://www.omg.org/spec/CCM/">OMG CORBA standard</a>.  Although CORBA provides several
benefits, it also has some limitations, especially when trying to implement
robust communication patterns other than Remote Procedure Calls (RPC). Still, a
distributed component model is valid and provides high-level entities that can
be mapped into object-oriented designs.</p>
<p>A <em>Component</em> is the basic building block in the SWCS architecture; it is a
Metamodel class (MKlass). Instances of Components are used in the GMT SWCS Model
to represent the concrete architecture of the system.  Components are used to
represent the main elements of a system and the relations between them. A
Component is specified and defined by a set of Features in the following Table:</p>
<table border="1" class="docutils" id="id22">
<caption><span class="caption-number">Table 21 </span><span class="caption-text">Component Features</span><a class="headerlink" href="#id22" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="18%" />
<col width="82%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Feature</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Name</td>
<td><div class="first last line-block">
<div class="line">Unique component identifier. Allows unambiguous identification</div>
<div class="line">of each individual component in the system (e.g.,</div>
<div class="line">ngws_xpatrol_ctrl).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Requirements</td>
<td><div class="first last line-block">
<div class="line">A list of requirements that can be associated with any type of</div>
<div class="line">component, allowing the allocation and traceability of</div>
<div class="line">requirements.</div>
</div>
</td>
</tr>
<tr class="row-even"><td>Notes</td>
<td><div class="first last line-block">
<div class="line">Arbitrary notes can be added to any component to capture</div>
<div class="line">information during the design process. This information can be</div>
<div class="line">useful for communication between different developers, but is</div>
<div class="line">not part of the specification of the component.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>State Machine</td>
<td><div class="first last line-block">
<div class="line">A state machine represents the operational state of a component.</div>
<div class="line">The Component state machine includes states to address the</div>
<div class="line">distributed nature of the component and its life cycle</div>
<div class="line">management.</div>
</div>
</td>
</tr>
<tr class="row-even"><td>Properties</td>
<td><div class="first last line-block">
<div class="line">Properties capture the persistent state of a component between</div>
<div class="line">different execution runs. The properties of a component are</div>
<div class="line">grouped into Component Configurations. Several configuration</div>
<div class="line">versions can be defined for a given component (e.g., diagnosis,</div>
<div class="line">engineering) and can be applied as a unit.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>State Variables</td>
<td><div class="first last line-block">
<div class="line">State variables allow continuous or episodic sampling of the</div>
<div class="line">phisical state of the Component. State variables are transported</div>
<div class="line">as a stream of time-stamped data. State variables are the source</div>
<div class="line">of the telemetry service. Telemetry communication is kept</div>
<div class="line">separated from control data.</div>
</div>
</td>
</tr>
<tr class="row-even"><td>Alarms</td>
<td><div class="first last line-block">
<div class="line">Alarms represent fault conditions that may affect the nominal</div>
<div class="line">behavior of the Component. The occurrence of an alarm is always</div>
<div class="line">reported.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Input Ports</td>
<td><div class="first last line-block">
<div class="line">Data inputs use communication ports that support low</div>
<div class="line">latency, synchronous and asynchronous control data flow. Data</div>
<div class="line">inputs and data outputs are specified with the data types and</div>
<div class="line">the maximum rate that they support. Data inputs and data output</div>
<div class="line">are linked with Connectors. Different operation modes may</div>
<div class="line">require different Quality of Service (QoS) between the same</div>
<div class="line">ports. Connectors include the QoS specification corresponding</div>
<div class="line">with connection configuration and the fault management strategy.</div>
</div>
</td>
</tr>
<tr class="row-even"><td>Output Ports</td>
<td><div class="first last line-block">
<div class="line">Data outputs are defined analogously to Data input features.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Elements</td>
<td><div class="first last line-block">
<div class="line">Aggregated components in the case of a composite Component.</div>
</div>
</td>
</tr>
<tr class="row-even"><td>Files</td>
<td><div class="first last line-block">
<div class="line">Auxiliary information that can be associated to complete the</div>
<div class="line">description of the Component.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>The semantics of the Component Features (see example below for the
<a class="reference internal" href="#code-property"><span class="std std-ref">Property</span></a> feature) are specified in Model Definition Files
(MDF).  MDFs use the same syntax as the SDFs, but their intent is to define the
concrete semantics of model elements. The Features of a Component define the
component interface as they express the external view of the Component. See
<a class="reference internal" href="../process/process_introduction.html#subsystem-specification-and-modeling"><span class="std std-ref">Subsystem Specification and Modeling</span></a> for a description of MDFs and SDFs.</p>
<p>One of the essential aspects of components is that it provides a way to address
<a class="reference external" href="http://en.wikipedia.org/wiki/Cross-cutting_concern">cross-cutting concerns</a>.
The <a class="reference internal" href="../services/observatory_services.html#observatory-services"><span class="std std-ref">Observatory Services</span></a> is a <a class="reference internal" href="../architecture/overall_architecture.html#architecture-control-domains"><span class="std std-ref">domain</span></a> that interfaces multiple domains: Observatory
Operations, Instrument Control System, Telescope Control System (see
<a class="reference internal" href="../architecture/overall_architecture.html#figure-domains-of-control"><span class="std std-ref">Figure</span></a>).  There, the <em>BaseComponent</em> class
addresses cross-cutting concerns by providing features to interface
<a class="reference internal" href="../services/observatory_services.html#section-service-adapters"><span class="std std-ref">Service Adapters</span></a>.  When a new component extends
the <em>BaseComponent</em> class it gains access to all the observatory services
through a small set of inherited methods.</p>
<div class="highlight-coffeescript" id="code-property"><div class="highlight"><pre><span></span><span class="nx">MKlass</span> <span class="s">&quot;Property&quot;</span><span class="p">,</span>
    <span class="k">extends</span><span class="o">:</span>    <span class="p">[</span><span class="s">&quot;Port&quot;</span><span class="p">]</span>
    <span class="nv">abstract: </span>  <span class="kc">false</span>
    <span class="nv">desc: </span>      <span class="s">&quot;Properties are the basic unit for component configuration&quot;</span>
    <span class="nv">features:</span>
        <span class="nv">units:</span>
        <span class="nv">kind: </span>  <span class="s">&quot;reference&quot;</span>
        <span class="nv">lower: </span> <span class="o">-</span><span class="mi">1</span>
        <span class="nv">upper: </span> <span class="mi">1</span>
        <span class="nv">type: </span>  <span class="s">&quot;UnitType&quot;</span>
        <span class="nv">desc: </span>  <span class="s">&quot;Units&quot;</span>
    <span class="nv">type:</span>
        <span class="nv">kind: </span>  <span class="s">&quot;attribute&quot;</span>
        <span class="nv">lower: </span> <span class="mi">1</span>
        <span class="nv">upper: </span> <span class="mi">1</span>
        <span class="nv">type: </span>  <span class="s">&quot;BaseDataType&quot;</span>
        <span class="nv">desc: </span>  <span class="s">&quot;Type of the Property&quot;</span>
    <span class="nv">min:</span>
        <span class="nv">kind: </span>  <span class="s">&quot;attribute&quot;</span>
        <span class="nv">lower: </span> <span class="o">-</span><span class="mi">1</span>
        <span class="nv">upper: </span> <span class="mi">1</span>
        <span class="nv">type: </span>  <span class="s">&quot;ValueType&quot;</span>
        <span class="nv">desc: </span>  <span class="s">&quot;Minimum value of the property&quot;</span>
    <span class="nv">max:</span>
        <span class="nv">kind: </span>  <span class="s">&quot;attribute&quot;</span>
        <span class="nv">lower: </span> <span class="o">-</span><span class="mi">1</span>
        <span class="nv">upper: </span> <span class="mi">1</span>
        <span class="nv">type: </span>  <span class="s">&quot;ValueType&quot;</span>
        <span class="nv">kind: </span>  <span class="s">&quot;Maximum value of the property&quot;</span>
    <span class="nv">default:</span>
        <span class="nv">kind: </span>  <span class="s">&quot;attribute&quot;</span>
        <span class="nv">lower: </span> <span class="mi">1</span>
        <span class="nv">upper: </span> <span class="mi">1</span>
        <span class="nv">type: </span>  <span class="s">&quot;ValueType&quot;</span>
        <span class="nv">desc: </span>  <span class="s">&quot;Default value of the property&quot;</span>
</pre></div>
</div>
<div class="section" id="distributed-communication">
<span id="id8"></span><h3>5.3.1. <em>Distributed Communication</em><a class="headerlink" href="#distributed-communication" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>The Core Framework supports different communication patterns, connection ports
and transports. The following two tables provide an overview.</p>
<table border="1" class="docutils" id="id23">
<caption><span class="caption-number">Table 22 </span><span class="caption-text">Communication Pattern Overview</span><a class="headerlink" href="#id23" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Communication Pattern</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Request-Reply</td>
<td><div class="first last line-block">
<div class="line">The request-reply pattern is used for sending requests from</div>
<div class="line">a REQ client to one or more REP services, and receiving</div>
<div class="line">subsequent replies to each request sent.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Publish-Subscribe</td>
<td><div class="first last line-block">
<div class="line">The publish-subscribe pattern is used for one-to many</div>
<div class="line">distribution of data from a single publisher to multiple</div>
<div class="line">subscribers in a fan out fashion.</div>
</div>
</td>
</tr>
<tr class="row-even"><td>Pipeline</td>
<td><div class="first last line-block">
<div class="line">The pipeline pattern is used for distributing data to nodes</div>
<div class="line">arranged in a pipeline. Data always flow down the pipeline,</div>
<div class="line">and each stage of the pipeline is connected to at least one</div>
<div class="line">node. When a pipeline stage is connected to multiple nodes</div>
<div class="line">data is “round-robin”-ed among all connected nodes.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Exclusive Pair</td>
<td><div class="first last line-block">
<div class="line">The exclusive pair pattern is used to connect a peer to</div>
<div class="line">precisely one other peer. This pattern is used for</div>
<div class="line">inter-thread communication across the <em>inproc</em> transport.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>GMT distributed component features are accessible through the control network.
The table below shows how different features require different communication
patterns and fault management or optimization strategies.  In the Table below,
High Water Mark (HWM) is the size of he incoming or outgoing buffer.</p>
<table border="1" class="docutils" id="id24">
<caption><span class="caption-number">Table 23 </span><span class="caption-text">Communication Pattern:  Fault Management &amp; Optimization Strategies</span><a class="headerlink" href="#id24" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="18%" />
<col width="20%" />
<col width="23%" />
<col width="19%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Feature Type</div>
<div class="line"><br /></div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Communication</div>
<div class="line">Pattern</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">On Fault</div>
<div class="line"><br /></div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">High Water</div>
<div class="line">Mark (HWM)</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Serialization</div>
<div class="line"><br /></div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Properties</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Request/Reply</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">retry</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">&gt; 1</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">MessagePack</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Commands</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Request/Reply</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">retry</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">&gt; 1</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">MessagePack</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Monitors</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">PUSH/PULL</div>
<div class="line">PUB/SUB</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Buffer to HWM</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">&gt; 1</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">MessagePack/Raw</div>
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Data I/O</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">PUSH/PULL</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">discard</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">no</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">MessagePack</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Alarms</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">PUSH/PULL</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Buffer to HWM</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">no  (?)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">MessagePack</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Logs</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">PUSH/PULL</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Buffer to HWM</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">&gt; 1</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">MessagePack</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>GMT distributed components support two operation modes, standalone and integrated:</p>
<blockquote>
<div><ul class="simple">
<li>In integrated mode, components will try to connect with the observatory
services. If the services are not available the component will stop its
startup sequence. This is the default operation mode when components are
integrated and deployed in the observatory or integration simulator.</li>
<li>In standalone mode, components do not try to connect to the observatory
services (e.g., log and alarms send their messages to the console). This
operation mode is intended to be used during initial component development.</li>
</ul>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="framework-implementation">
<h3>5.3.2. <em>Framework Implementation</em><a class="headerlink" href="#framework-implementation" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>The Core Framework hides the implementation details, like the middleware
software used or the transport protocol. The implementation of the framework
is based on the ZeroMQ middleware. ZeroMQ does not include a serialization
mechanism; this provides the flexibility to use different serialization
formats depending on the use case (e.g., <a class="reference external" href="http://en.wikipedia.org/wiki/Protocol_Buffers">ProtocolBuffers</a>, <a class="reference external" href="http://en.wikipedia.org/wiki/MessagePack">MessagePack</a>, raw bytes, JSON, hdf5). The
Section on <a class="reference internal" href="../platform/platform.html#platform"><span class="std std-ref">Platform</span></a> provides an overview of the ZeroMQ middleware. The
table below describes several communication patterns implemented by means of
several socket types, based on ZeroMQ Socket Types.</p>
<table border="1" class="docutils" id="id25">
<caption><span class="caption-number">Table 24 </span><span class="caption-text">Communication Pattern Implementation:  Socket Types</span><a class="headerlink" href="#id25" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Socket Type</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">REQ</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Used by a client to send requests and receive replies from a</div>
<div class="line">service. Each request sent is round-robined among all services,</div>
<div class="line">and each reply received is matched with the last issued request.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">REP</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Used by a service to receive requests from and sent replies to a</div>
<div class="line">client. Each request received is fair-queued from among all</div>
<div class="line">clients.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">DEALER</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Used for extending request/reply sockets. Each message sent is</div>
<div class="line">&#8220;round-robin&#8221;-ed among all connected peers, and each message</div>
<div class="line">received is fair- queued from all connected peers.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">ROUTER</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Used for extending request/reply sockets. When receiving</div>
<div class="line">messages a ROUTER socket shall prepend a message part containing</div>
<div class="line">the identity of the originating peer to the message before</div>
<div class="line">passing it to the application. Messages received are fair-queued</div>
<div class="line">from among all connected peers.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">PUB</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Used by a publisher to distribute data.  Messages sent are</div>
<div class="line">distributed in a fan out fashion to all connected peers.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">SUB</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Used by a subscriber to subscribe to data distributed by a</div>
<div class="line">publisher.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">XPUB</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Same as PUB except that the socket can receive subscriptions</div>
<div class="line">from the peers in form of incoming messages.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">XSUB</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Same as SUB except that the socket can subscribe by sending</div>
<div class="line">subscription messages to the socket.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">PUSH</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Used by a pipeline node to send messages to downstream pipeline</div>
<div class="line">nodes. Messages are &#8220;round-robin&#8221;-ed to all connected downstream</div>
<div class="line">nodes.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">PULL</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Used by a pipeline node to receive messages from upstream</div>
<div class="line">pipeline nodes. Messages are fair-queued from among all</div>
<div class="line">connected upstream nodes.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">PAIR</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Can only connect to a single peer at any one time. No message</div>
<div class="line">routing or filtering is performed over a PAIR socket.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>ZeroMQ also provides various transports like in-process, inter-process, TCP and
multicast and has a small memory footprint, making it a good candidate to be
used as a concurrency framework.</p>
<p>The Table below gives an overview of available communication transports.</p>
<table border="1" class="docutils" id="id26">
<caption><span class="caption-number">Table 25 </span><span class="caption-text">Available Communication Transports</span><a class="headerlink" href="#id26" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="17%" />
<col width="83%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Transport</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>tcp</td>
<td>Unicast transport using TCP</td>
</tr>
<tr class="row-odd"><td>ipc</td>
<td>Local inter-process communication transport</td>
</tr>
<tr class="row-even"><td>inproc</td>
<td>Local in-process (inter-thread) communication transport</td>
</tr>
<tr class="row-odd"><td>pgm, epgm</td>
<td>Reliable multicast transport using PGM</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
<div class="section" id="device-control-framework">
<span id="id9"></span><h2>5.4. Device Control Framework<a class="headerlink" href="#device-control-framework" title="Permalink to this headline">¶</a></h2>
<p>Device control subsystems (e.g., primary mirror control system, ASM control
system) command mechanical degrees of freedom or read optical and other sensors.
The Section on <a class="reference internal" href="../tcs/tcs_introduction.html#tcs-subsystems"><span class="std std-ref">TCS Subsystems</span></a> presents a list of the
most significant device control subsystems in the TCS. Their degrees of freedom
are represented by a set of state variables, which define the observed and
desired state of the system and are often updated in an arrangement of nested
control loops. These control loops may be implemented with different strategies:</p>
<blockquote>
<div><ul class="simple">
<li>The complete control loop is implemented in an embedded smart controller
(e.g., a COTS motion drive that implements the EtherCAT CoE DS-402 profile).
The embedded controller is supervised by a software component that allows
the integration with the rest of the observatory services. This is the
recommended implementation when a system under control has a single degree
of freedom and single or dual feedback (the Rotation or Pupil stage of the
LTWS is an example of this arrangement).</li>
<li>The system under control requires multiple actuators and/or feedback
sensors, even if it has a single degree of freedom. In this case, part of
the control loop runs inside a smart controller like in the previous case,
but some part of the loop needs to runs in a high level controller – given
that in this scenario it is difficult to find a commercial standardized
product that provides the adequate number of inputs, outputs and capability
of closing the loops using them (e.g., mount control system).</li>
<li>Optical degrees of freedom are often grouped in large interdependent sets.
This scenario requires that the controller estimate the current state and
calculate the desired state in complex computations with very diverse ranges
of update regimes. These calculations are very specific to the optical
system under control, so no standard solutions or commercial products exist.
In this case, the development of specific software run on high performance
computing hardware may be necessary (e.g., wavefront control).</li>
</ul>
</div></blockquote>
<div class="figure" id="id27">
<img alt="../../_images/control-loop.png" src="../../_images/control-loop.png" />
<p class="caption"><span class="caption-number">Fig. 43 </span><span class="caption-text">General Scheme of a Control Loop Implementation</span></p>
</div>
<p>Although the principal function of a Device Control Subsystem is the control of
hardware devices, an efficient and robust operation requires the development of
other important functions:</p>
<blockquote>
<div><ul class="simple">
<li><strong>Calibration</strong> - In many subsystems, calibration software is required to produce
error maps or look-up tables (LUT) that allow the control system to perform
with the necessary accuracy.</li>
<li><strong>Diagnosis</strong> - Some of the GMT hardware subsystems are quite complex. Specific
software components are often required to verify the behavior of the system
or to troubleshoot it in case of incorrect behavior.</li>
<li><strong>Safety</strong> - There are some scenarios where a hardware device could be damaged
due to incorrect operation. The Interlock and Safety System (ISS) is
ultimately responsible to prevent any damage to equipment or injury to
people by the telescope. The ISS “kicks-in” often in a dramatic way. Safety
control components provide safe guards to preempt the engagement of the ISS.</li>
<li><strong>Supervision</strong> - Often the operation of a subsystem involves coordinating
several subordinate components. It is then the TCS responsibility to
guarantee that subordinate components are in the correct state and that the
performance degrades gracefully in off-nominal scenarios. In addition to
managing the configuration, and startup/shutdown of the control subsystems
and hardware devices, supervisory components also implement kinematic
transformations or anti-collision protection strategies when the system
under control requires it.</li>
</ul>
</div></blockquote>
<div class="section" id="controller-state-machine">
<span id="id10"></span><h3>5.4.1. <em>Controller State Machine</em><a class="headerlink" href="#controller-state-machine" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>A state machine represents the operational state of a Component.  A set of
states addresses the distributed nature of the component and its life cycle
management.  The Figure below shows the Controller state machine.  Only the
description of each state is shown.  Details about entry actions, transitions
and activities are omitted in this diagram.</p>
<div class="figure" id="id28">
<img alt="../../_images/controller-state-machine.png" src="../../_images/controller-state-machine.png" />
<p class="caption"><span class="caption-number">Fig. 44 </span><span class="caption-text">Controller State Machine</span></p>
</div>
<p>The table below provides the specification of the Controller state machine.  The
specification defines what actions to implement in every state or transition,
however in some of the states each Controller implements its own specific logic.</p>
<table border="1" class="docutils" id="id29">
<caption><span class="caption-number">Table 26 </span><span class="caption-text">Component State Machine Specification</span><a class="headerlink" href="#id29" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="17%" />
<col width="83%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">State</th>
<th class="head"><div class="first last line-block">
<div class="line">State Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>INITIAL</td>
<td><div class="first last line-block">
<div class="line">Initial pseudo state.  The Controller is not operational because</div>
<div class="line">has not been created yet.  The Controller cannot inform this</div>
<div class="line">state as it is not running.  In this state the software is not</div>
<div class="line">running and controlled equipment is not available.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>TERMINAL</td>
<td><div class="first last line-block">
<div class="line">Final pseudo state of any Controller.  It’s equivalent to the</div>
<div class="line">initial state.  A final state cannot have any outgoing</div>
<div class="line">transitions.</div>
</div>
</td>
</tr>
<tr class="row-even"><td>PREVIOUS STATE</td>
<td><div class="first last line-block">
<div class="line">This pseudo state is a UML formalism that, within a composite</div>
<div class="line">state, allows remembering the previous sub-state that was active</div>
<div class="line">prior to leaving the composite state.  This is used when a</div>
<div class="line">Controller enters the FAULT or DISABLED states.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>OFF</td>
<td><div class="first last line-block">
<div class="line">The Controller is created, loaded and initialized with the</div>
<div class="line">default properties, but part of the software and hardware is not</div>
<div class="line">initialized and configured yet.  All the external Devices</div>
<div class="line">controlled by the Controller shall be switched-off.  In this</div>
<div class="line">state the Controller is not ready for operation, but it is</div>
<div class="line">possible to perform tests and diagnostics activities, specially</div>
<div class="line">related to the communication capabilities.  The Controller is in</div>
<div class="line">a static state waiting for events.</div>
</div>
</td>
</tr>
<tr class="row-even"><td>STARTING</td>
<td><div class="first last line-block">
<div class="line">The Controller is being started.  Any external equipment</div>
<div class="line">controlled by the Controller is being switched on.  In some</div>
<div class="line">cases, the power supply is shared with other Controllers.  It</div>
<div class="line">also performs the starting procedure which can include:</div>
<div class="line"><br /></div>
<div class="line-block">
<div class="line">• Obtain the configuration properties from the configuration system.</div>
<div class="line">• Get references to the required device or bus drivers.</div>
<div class="line">• Start telemetry samplers, alarm rules, etc.</div>
<div class="line">• Check communication with the connected Devices (e.g., a</div>
<div class="line-block">
<div class="line">motion drive).</div>
</div>
<div class="line">• Other activities will depend on the specific Controllers and Devices</div>
<div class="line-block">
<div class="line">connected to it.</div>
</div>
</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>ON</td>
<td><div class="first last line-block">
<div class="line">The Controller and the connected Devices are already properly</div>
<div class="line">initialized and configured.  When connected, and depending on</div>
<div class="line">the Controller, external equipment shall be in safe state (e.g.,</div>
<div class="line">brake engaged, motion drives disabled, locking pins inserted).</div>
<div class="line">This state can be the final state after a reset or after a power</div>
<div class="line">failure.</div>
</div>
</td>
</tr>
<tr class="row-even"><td>INITIALIZING</td>
<td><div class="first last line-block">
<div class="line">While the Controller is in this state the necessary procedures</div>
<div class="line">required to make the controller ready to receive operation</div>
<div class="line">requests (e.g., find fiducial marks) are executed.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>IDLE</td>
<td><div class="first last line-block">
<div class="line">The Controller is completely idle.  It is not serving any</div>
<div class="line">command and no data input is driving its control loop.</div>
</div>
</td>
</tr>
<tr class="row-even"><td>RUNNING</td>
<td><div class="first last line-block">
<div class="line">The Controller is serving and operation request.  In this state</div>
<div class="line">the Controller can receive new commands or is accepting data in</div>
<div class="line">its data inputs and sending data through its data outputs.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>SHUTTING DOWN</td>
<td><div class="first last line-block">
<div class="line">Back to OFF state (different for each Controller: power off Devices)</div>
</div>
</td>
</tr>
<tr class="row-even"><td>HALTING</td>
<td><div class="first last line-block">
<div class="line">Back to ON state (different for each Controller: Engage brakes,</div>
<div class="line">disable drives)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>FAULT</td>
<td><div class="first last line-block">
<div class="line">The Controller has detected a severe failure and is waiting for</div>
<div class="line">an event to occur  (e.g., operator input) to correct such situation.</div>
</div>
</td>
</tr>
<tr class="row-even"><td>RESETTING</td>
<td><div class="first last line-block">
<div class="line">Returns to a safe and known state.  For example, when the</div>
<div class="line">Controller has entered in FAULT state due to the ISS triggering</div>
<div class="line">and interlock condition (which can disable drives, remove power,</div>
<div class="line">etc.) a reset command must be sent to the Controller.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>DISABLED</td>
<td><div class="first last line-block">
<div class="line">In this state the Controller rejects to perform any control</div>
<div class="line">action.  This is especially important with Controllers connected</div>
<div class="line">to Devices.  In this state the Controller does not send demands</div>
<div class="line">to the equipment requesting motion or a change (a message is</div>
<div class="line">sent to the client indicating that the Controller is disabled).</div>
<div class="line">Note that the Controller is ready and it will answer requires</div>
<div class="line">asking for some status, but it will not execute any commands</div>
<div class="line">that imply acting on the connected Devices.  This state can be</div>
<div class="line">reached from any state, and when enabled, will return to the</div>
<div class="line">previous state.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Controllers that interface with hardware support specialized operation modes,
on-line and simulated:</p>
<blockquote>
<div><ul class="simple">
<li>In <em>on-line mode</em>, controllers try to detect and setup the hardware elements
connected to them during startup. If some of the required hardware devices
are not available the controller will transition to fault mode. On-line is
the default mode when the system is deployed for operation at the
observatory.</li>
<li>In <em>simulation mode</em>, controllers will setup the I/O framework in simulation
mode. Communication messages with the hardware will be logged, but will not
be sent to the hardware devices. Hardware devices will not be powered up
during the startup sequence. This mode is intended to be use during
development when the hardware is not yet available or is available
partially. It also enables controller debugging once the hardware is
integrated.</li>
</ul>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="supervisors">
<h3>5.4.2. <em>Supervisors</em><a class="headerlink" href="#supervisors" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>In addition to direct control of Devices, control subsystems require the
implementation of supervisory functions when several Devices have to be operated
in a coordinated manner. Supervisors also provide the implementation of the
high-level interface to a subsystem. A high- level interface reduces the
coupling between subsystems, encapsulates the subsystem implementation details
and minimizes the propagation of implementation changes. There could be
exceptions due to performance issues (e.g., a component need direct access to
the low-latency network). Depending on the specifics of every subsystem,
Supervisors can provide the following functions:</p>
<blockquote>
<div><ul class="simple">
<li>Subsystem integrity (e.g., collision avoidance)</li>
<li>Subsystem component configuration (e.g., components are configured in the
right sequence and with the right configuration properties, LUTs)</li>
<li>Subsystem robustness (e.g., behavior in presence of no nominal conditions,
fault management and tolerance)</li>
<li>Subsystem life-cycle (e.g., startup and shutdown)</li>
<li>Subsystem embedded diagnosis</li>
<li>Subsystem modal transition (for subsystems that have different modes of operation)</li>
<li>Subsystem IO health</li>
</ul>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="device-controller-library">
<h3>5.4.3. <em>Device Controller Library</em><a class="headerlink" href="#device-controller-library" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Based on the analysis of the degrees of freedom of the telescope (see
<a class="reference internal" href="../tcs/tcs_introduction.html#tcs-degrees-of-freedom"><span class="std std-ref">TCS degrees of freedom</span></a>), a set of common device
control cases have been identified. These cases are based on the motion
profiles defined in the IEC 61800-7-201 standard <a class="reference internal" href="../bibliography/bibliography.html#iec61800-7-201" id="id11">[IEC61800-7-201]</a>.  The
framework provides a set of Components that implement those cases. The Figure
below shows the Controller class hierarchy.</p>
<div class="figure" id="id30">
<img alt="../../_images/device-controller-class-hierarchy.png" src="../../_images/device-controller-class-hierarchy.png" />
<p class="caption"><span class="caption-number">Fig. 45 </span><span class="caption-text">Device Controller Class Hierarchy</span></p>
</div>
</div></blockquote>
</div>
<div class="section" id="device-control-subsystem-deployment">
<h3>5.4.4. <em>Device Control Subsystem Deployment</em><a class="headerlink" href="#device-control-subsystem-deployment" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>During the design process, the functional description of the Controller features
is refined and a hardware deployment model is created as part of the electronic
design. The hardware deployment model includes the definition of processing
resources and the Input/Output modules that interface with the hardware devices.
All this information is captured in the domain model SDFs and used to generate
code skeletons and configurations used by the implementation.</p>
<p>The mapping between process image and controller features is completely
independent of the protocol used to access the hardware. IOModule adapters
provide independence from the specific fieldbus (the Section on
<a class="reference internal" href="#io-framework"><span class="std std-ref">I/O Framework</span></a> describes how the I/O Framework supports this process).
The code-block below presents an example of the deployment specification of a
Device Control Subsystem:</p>
<div class="highlight-coffeescript"><div class="highlight"><pre><span></span><span class="nx">Host</span> <span class="s">&quot;agws_dcc&quot;</span><span class="p">,</span>
    <span class="nv">desc: </span>     <span class="s">&quot;AGWS Control System Device Control Computer&quot;</span>
    <span class="nv">location: </span> <span class="s">&quot;gmt.er_ecab_03&quot;</span>
    <span class="nv">buses:</span>
        <span class="nv">ecat_01:</span>
            <span class="nv">update_rate: </span> <span class="mi">2000</span>
            <span class="nv">io_modules:</span>
                <span class="nv">E11010:</span>
                    <span class="nv">desc: </span>     <span class="s">&quot;Bus Head Coupler&quot;</span>
                    <span class="nv">location: </span> <span class="nx">gmt</span><span class="p">.</span><span class="nx">gir_ecab_01</span>
                    <span class="nv">ports:</span>
                        <span class="nv">X001: </span> <span class="nx">gmt</span><span class="p">.</span><span class="nx">dccs</span><span class="p">.</span><span class="nx">agws_dcc</span><span class="p">.</span><span class="nx">ether_01</span>
                        <span class="nv">X002: </span> <span class="nx">gmt</span><span class="p">.</span><span class="nx">agws_dcc</span><span class="p">.</span><span class="nx">ecat</span><span class="p">.</span><span class="nx">el7301</span><span class="p">.</span><span class="nx">X001</span>

<span class="nx">Subsystem</span> <span class="s">&quot;agws_cs&quot;</span><span class="p">,</span>
    <span class="nv">io_routing:</span>
        <span class="nv">port: </span> <span class="nx">gmt</span><span class="p">.</span><span class="nx">agws_dcc</span><span class="p">.</span><span class="nx">ether_01</span>
        <span class="nv">port: </span> <span class="nx">gmt</span><span class="p">.</span><span class="nx">agws_dcc</span><span class="p">.</span><span class="nx">ecat</span><span class="p">.</span><span class="nx">EL1011</span><span class="p">.</span><span class="nx">X001</span>
</pre></div>
</div>
<div class="figure" id="id31">
<img alt="../../_images/device-control-subsystem-deployment.png" src="../../_images/device-control-subsystem-deployment.png" />
<p class="caption"><span class="caption-number">Fig. 46 </span><span class="caption-text">Device Control Subsystem Deployment.  Controllers (e.g., <em>agws_arm1_ctrl</em>) are
deployed in Device Control Computers (<em>agws_cs_dcc</em>) in the control room
electronic cabinets.</span></p>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="persistence-framework">
<span id="id12"></span><h2>5.5. Persistence Framework<a class="headerlink" href="#persistence-framework" title="Permalink to this headline">¶</a></h2>
<p>The Persistence Framework (PF) provides support for the storage of data
structures and files. It acts as a data access layer between the components and
the databases and file systems, and provides a mapping between application data
structures and the database.</p>
<p>The GMT uses and produces different types of data:</p>
<blockquote>
<div><ul class="simple">
<li>Time series data that are streamed by the telemetry, alarm and log services.
These streams of data have to be stored with efficient use of space and
adequate performance. These data collections need to be queried in order to
support analysis.</li>
<li>Science instruments and WFS produce detector frames.</li>
<li>Several thousands of components are deployed in the runtime system; each one
has its own configuration parameters. This data has to be accessed during
the startup of the system and also during normal operation.</li>
<li>Observing programs, calibration pipeline parameters and observing sequences
are stored and accessed by different applications during the lifecycle of an
observation.</li>
</ul>
</div></blockquote>
<p>The table below shows the data persistence strategies:</p>
<table border="1" class="docutils" id="id32">
<caption><span class="caption-number">Table 27 </span><span class="caption-text">Data Persistence Strategies</span><a class="headerlink" href="#id32" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="26%" />
<col width="28%" />
<col width="19%" />
<col width="27%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Data Type</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Storage Strategy</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Persistence</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Data format</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Science and WFS</div>
<div class="line">frames</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Files +</div>
<div class="line">metadata object store</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Permanent/</div>
<div class="line">Time partition</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">FITS + MongoDB</div>
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Telemetry streams</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Files +</div>
<div class="line">metadata object store</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Time partition</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">HDF5/BSON/MessagePack +</div>
<div class="line">MongoDB</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Alarm, Log streams</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Object store</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Time partition</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">NoSQL DB (MongoDB)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Configuration</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Object store</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Permanent</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">NoSQL DB (MongoDB)</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Observing Programs</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Object store</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Permanent</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">NoSQL DB (MongoDB)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Observing Sequences</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Object store</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Permanent</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">NoSQL DB (MongoDB)</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Recipe Parameters</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Object store</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Permanent</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">NoSQL DB (MongoDB)</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>The design of the Persistence Framework is based on the use of a High
Performance File System like <a class="reference external" href="http://www.opensfs.org/lustre">Lustre</a> in
combination with a <a class="reference external" href="http://en.wikipedia.org/wiki/NoSQL">NoSQL</a> database to
store component configurations and file metadata. High Performance File System
and NoSQL database technology is in constant evolution in order to address
BigData and large-scale web applications.  Although the outcome of some
prototypes using the <a class="reference external" href="http://en.wikipedia.org/wiki/MongoDB">MongoDB</a> database
to assess its feasibility as a metadata store has been very encouraging, it is
advisable to delay the adoption of a concrete technology until the detailed
design phase to take advantage of further technology developments. MongoDB is
been used meanwhile to develop the Application Programming Interface of the
Persistence Framework.</p>
</div>
<div class="section" id="data-processing-framework">
<span id="id13"></span><h2>5.6. Data Processing Framework<a class="headerlink" href="#data-processing-framework" title="Permalink to this headline">¶</a></h2>
<p>The Data Processing Framework (DPF) provides support for the development of data
processing pipelines. Specific examples of data processing pipelines include:
statistics (image noise and S/N estimation, sky brightness, seeing estimation,
number of sources), astrometry (computing WCS for imaging detectors), image
matching (coordinate transformation, image registration), data filtering, image
cube construction, data extraction (e.g., IFS wavelength slices), image
manipulation (masking, interpolation), image analysis, PSF creation (AO PSF
simulation), spectral analysis, photometric calibration, spectral reduction,
image reduction, image mosaic creation, etc.</p>
<p>The framework design is based on the Pipes and Filter design pattern. Pipelines
act as wrappers of existing or newly developed data reduction systems and
provide a thin unified interface to the observatory operations software. The
goal of this approach is to reach a balance between the uniform operation and
maintenance of the observatory and the cost of developing new pipelines that are
successors of existing ones.</p>
<p>The table below provides a definition of the main DPF components:</p>
<table border="1" class="docutils" id="id33">
<caption><span class="caption-number">Table 28 </span><span class="caption-text">Data Processing Framework Component Description</span><a class="headerlink" href="#id33" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Component Name</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Pipeline</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Collection of Filters and data processing Recipes</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Filter</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Elementary processing unit of a data processing pipeline (e.g.,</div>
<div class="line">bias or dark filter in a data reduction pipeline). Each Filter</div>
<div class="line">has a set of data inputs and outputs and a set of parameters</div>
<div class="line">that tailor its behavior. Data inputs and outputs can be streams</div>
<div class="line">or files and often capture an intermediate processing step. The</div>
<div class="line">Core Framework provides different communication transports (e.g.</div>
<div class="line">inproc, ipc, tcp) for flexible and efficient I/O management and</div>
<div class="line">deployment.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Recipe</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Defines a concrete sequence of connected Filters. Each Recipe</div>
<div class="line">has a set of data inputs, data outputs, parameters and</div>
<div class="line">validation rules (e.g., an instrument data processing pipeline</div>
<div class="line">may define a Recipe for each observing mode that requires a</div>
<div class="line">different data reduction strategy). The execution of Recipes</div>
<div class="line">will be often triggered during the execution of an observing</div>
<div class="line">sequence.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>The Figure below shows the DPF in the context of the definition of an
observation.</p>
<div class="figure" id="id34">
<img alt="../../_images/data-processing-framework-components.png" src="../../_images/data-processing-framework-components.png" />
<p class="caption"><span class="caption-number">Fig. 47 </span><span class="caption-text">Data Processing Framework Components</span></p>
</div>
<p>Each Pipeline is specified by a set of SDFs that defines the interface of the
Filters and Recipes components making up a pipeline. This interface enables the
operation and integration of all the data pipelines in a uniform way, and
provides the following capabilities:</p>
<blockquote>
<div><ul class="simple">
<li>Execution of the corresponding Recipes when the input and calibration data
are available</li>
<li>Instantiation of a quick-look display when requested by the operator</li>
<li>Storage of by-products of the pipeline consistently throughout the
observatory.</li>
</ul>
</div></blockquote>
<p>The framework includes tools that generate a set of Python interface skeletons
that then act as wrappers of existing or new data pipelines. Skeletons have to
be completed by the pipeline developer.</p>
<p>Multiple implementations of data processing tools and algorithms are available;
some of them are summarized here:</p>
<blockquote>
<div><ul class="simple">
<li><em>Data Analysis Facilities</em> - These are fully self-contained (e.g., PyRAF, IRAF)
packages that come with tools for image display, data manipulation,
analysis, and scripting, with which many observers are familiar. These
packages also facilitate the development of high-level tools for instrument
data reduction and quick-look extraction or analysis.</li>
<li><em>Numerical Libraries</em>: Numerical libraries (e.g., LAPACK, ATLAS, FFTW, GSL,
SciPy) will be the basis for developing software that requires
high-performance numerical computations.</li>
<li><em>Data Extraction and Modeling</em> - Data extraction and modeling tools (e.g.,
PSFEx, SExtractor, GALFIT) are useful for exposure time calculations during
proposal preparation. They are also used during runtime operations for
producing seeing statistics, data summary, astrometry, and to aid the
monitoring of environmental conditions and data quality.</li>
<li><em>Positional Astronomy</em> and <em>Coordinate Transformation</em> - These tools (e.g.,
SLALIB, SCAMP, WCSTools) are commonly used for relating sky coordinates and
detector coordinates in images and for telescope pointing, for calculating
spherical geometry, and for aligning imaging or spectroscopic data.</li>
<li><em>Data Container</em> - Data containers transform a data type into another type
(e.g., CFITSIO), or repackage data to be compliant with a standard format
(e.g., Virtual Observatory).</li>
<li><em>Data Visualization</em> - These tools (e.g., SAOImage JS9, WebGL) facilitate
visualization of operational data, such as line or scatter plots; reduced,
imaging, spectroscopy, or integral- field, data; exposure time calculation,
and runtime observing displays.</li>
<li><em>Telescope Pointing Kernel</em> and <em>Pointing Analysis</em> - TCSpk and TPoint will
be the primary tools used for computing telescope pointing models,
generating pointing demands, and performing pointing analysis to remove
pointing errors due to flexure, alignment errors, or mechanical
imperfections.</li>
</ul>
</div></blockquote>
<p>The Software and Controls Handbook defines a set of requirements (e.g.,
operating system compatibility, hardware acceleration) that have to be met by
the data reduction packages and libraries used in the implementation of the data
processing pipelines.</p>
</div>
<div class="section" id="time-distribution-framework">
<span id="id14"></span><h2>5.7. Time Distribution Framework<a class="headerlink" href="#time-distribution-framework" title="Permalink to this headline">¶</a></h2>
<p>The Precision Time Protocol is a method by which a cluster of computers,
communicating over a Local Area Network, can keep their local clock synchronized
to a better time source, commonly referred to as a Master Clock.</p>
<p>The protocol is defined by the <a class="reference external" href="https://www.nist.gov/el/intelligent-systems-division-73500/ieee-1588">IEEE 1588 standard</a>, and
enables heterogeneous systems that include clocks of various inherent precision,
resolution, and stability to synchronize to a grandmaster clock. The protocol
supports system-wide synchronization accuracy in the sub-microsecond range
requiring minimal network and local clock computing resources.</p>
<p>Different implementations are available from open-source projects and commercial
vendors. Prototyping activities have shown PTP to be a suitable time
distribution framework for GMT, capable of microseconds synchronization.
Different vendors offer cost effective IEEE 1588 Grandmaster Clock with GPS
(Global Positioning System) reference that supports the latest PTP version 2
protocol. Additional IEEE 1588 enabled Ethernet switches can be deployed for
improved performances.</p>
<p>Similarly to NTP, deployment is straightforward and just requires a daemon to be
running,. The daemon adjusts the system-wide real-time clock of the computer,
and is thus transparent to users or applications using standard calls.</p>
</div>
<div class="section" id="user-interface-framework">
<span id="id15"></span><h2>5.8. User Interface Framework<a class="headerlink" href="#user-interface-framework" title="Permalink to this headline">¶</a></h2>
<p>The User Interface Framework (UIF) provides a set of common reusable Widgets
(user interface graphic elements) and Panels. Widgets and Panels are the
building blocks used to construct the GMT user interfaces. The Table below provides
a list of some of these components, based on <a class="reference external" href="http://d3js.org">d3.js</a>.</p>
<table border="1" class="docutils" id="id35">
<caption><span class="caption-number">Table 29 </span><span class="caption-text">Widget Description</span><a class="headerlink" href="#id35" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Widget Name</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Scalar</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Visualizes the instant numeric value of a quantity.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Line/Area chart</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Visualizes the value of a quantity or set of quantities versus</div>
<div class="line">another.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Time chart</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Visualizes and updates the value of a quantity or set of</div>
<div class="line">quantities versus time.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Box plot</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Summarizes a quantitative distribution with five standard</div>
<div class="line">statistics: The smallest value, lower quartile, median , upper</div>
<div class="line">quartile, and largest value.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Bullet chart</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Compares a given quantitative measure against qualitative</div>
<div class="line">ranges (e.g., linear position and limit ranges).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Calendar view</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Visualizes values as colored cells per day.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Treemap</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Recursively subdivides area into rectangles, the area of any</div>
<div class="line">node in the tree corresponds to its value (e.g., visualization</div>
<div class="line">of subsystem and components alarm states).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Chord diagram</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Shows directed relationships among a group of entities.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Matrix diagram</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Visualizes an NxN relationship (e.g., active component port</div>
<div class="line">connections in a wavefront control observing mode).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Crossfilter</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Supports exploration of large multivariable datasets.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">WFS RT display</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Displays WFS pixels, slopes in realtime (24fps).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Image viewer</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Supports the visualization of FITS data.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>As in previous cases the use of a framework facilities a consistent design and
documentation, improves system predictability as all widgets operate
consistently in different scenarios, and reduces development costs.</p>
<p>In addition to reusable components the framework defines some user interface
guidelines:</p>
<blockquote>
<div><ul>
<li><p class="first">Shape, size and color attributes are used only when they carry specific
semantics <a class="reference internal" href="../bibliography/bibliography.html#tuft01" id="id16">[Tuft01]</a>.</p>
</li>
<li><p class="first">The user interface style is flat with no bevels or tridimensional effects.</p>
</li>
<li><p class="first">No decoration shall be used if it does not convey any semantics.</p>
</li>
<li><p class="first">The user interface shall support the exploration of available options in a
clear, unambiguous way.</p>
</li>
<li><p class="first">In any operational context, information shall be readily visible and
available without a user having to hunt around, such as by navigating series
of pull-down menus or layers.</p>
</li>
<li><p class="first">Users normally perform tasks following workflows, therefore visual
information shall support the process of decision making related to the task
at any given moment.</p>
</li>
<li><p class="first">Information shall be displayed using the appropriate visualization for the
task context.</p>
</li>
<li><p class="first">The layout of the Operations interface shall be fixed for the most part.
This guarantees that the information relevant to the operation of the system
is always visible. Although part of the user interface shall be flexible to
adapt to the task at hand, the fixed part of the user interface enables
different users of the system to adopt a common language and vocabulary.</p>
</li>
<li><p class="first">All the remote operations centers shall have a consistent layout. This
facilitates support and troubleshooting tasks.</p>
</li>
<li><p class="first">User interface components shall be arranged according to a logical sequence
that enables one to intuit where, on a screen, an element would be located.
Two main criteria shall be used, physical distribution and temporal
distribution:</p>
<blockquote>
<div><p>Physical distribution – Widgets that represent the state of a system shall
be arranged according to the geometric organization of the physical
elements, e.g., in the main status screens all user interface components are
arranged from left to right following the location of the systems from the
outside to the inside.</p>
<p>Temporal distribution – All the widgets that support the operation
workflows of the observatory are arranged following the same distribution
as a Kanban diagram. Section 10.3.3.4 (Operational User Interfaces, TBA)
shows the main operation displays, which follow this principle.</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<p>The Figure below shows an example of the design of a widget according to these
principles. A detailed description of all the widgets is out of the scope of
this document.</p>
<div class="figure" id="id36">
<img alt="../../_images/engineering-scalar-widget-example.png" src="../../_images/engineering-scalar-widget-example.png" />
<p class="caption"><span class="caption-number">Fig. 48 </span><span class="caption-text">Scalar Widget Design</span></p>
</div>
</div>
<div class="section" id="i-o-framework">
<span id="io-framework"></span><h2>5.9. I/O Framework<a class="headerlink" href="#i-o-framework" title="Permalink to this headline">¶</a></h2>
<p>The I/O Framework (IOF) provides the infrastructure to develop observatory
compliant Device Controllers based on EtherCAT technology. The Section on
<a class="reference internal" href="../platform/platform.html#field-device-interface"><span class="std std-ref">Field Device Interface Technology</span></a> provides a more detailed description of EtherCAT.
The IOF provides the following capabilities:</p>
<blockquote>
<div><ul class="simple">
<li>Tools to assist developers with the definition of their application’s I/O.</li>
<li>Templates that can be reused or extended based on reference definitions and
implementations.</li>
<li>Standard environment to build, test and deploy systems.</li>
<li>Abstraction layers to keep underlying 3rd party software packages
transparent, and hide the complexity and low-level implementation details.</li>
<li>Tools to assist with prototyping, testing, debugging and validation during
all the steps of the development process.</li>
<li>Scripting capabilities and a command line interface for rapid development.</li>
</ul>
</div></blockquote>
<div class="section" id="terminology">
<h3>5.9.1. <em>Terminology</em><a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>A <em>Device</em> is a real world, physical entity representing the system under
control.  A <em>device controller</em> is a standard software component (see the
<a class="reference internal" href="#device-control-framework"><span class="std std-ref">following section</span></a>). The device controller
relays input and output signals to control hardware devices.  An <em>IOModule</em> is
a hardware independent representation of an I/O module terminal whereas the
<em>IOModuleDriver</em> provides the hardware dependent implementation, e.g., due to
vendor specific electronics implementation. An IO module terminal is a
real-world electronics component built into a hardware device assembly.</p>
<div class="figure" id="id37">
<img alt="../../_images/framework-overview.png" src="../../_images/framework-overview.png" />
<p class="caption"><span class="caption-number">Fig. 49 </span><span class="caption-text">Framework Overview</span></p>
</div>
<p>While particular hardware assemblies may rely on highly specialized controllers
(e.g., cameras, deformable mirrors) a substantial number of hardware assemblies
can be identified in the telescope design that rely on a limited set of
fundamental generic <a class="reference internal" href="../tcs/tcs_introduction.html#tcs-degrees-of-freedom"><span class="std std-ref">building blocks</span></a>. These
primitive I/O modules can be grouped into generic families:</p>
<blockquote>
<div><ul class="simple">
<li>Digital Input and Output modules</li>
<li>Analog Input and Output modules</li>
<li>Position Measurement modules</li>
<li>Motion control modules</li>
<li>Communication modules, e.g., Serial or Ethernet – often used to bridge more
integrated systems</li>
</ul>
</div></blockquote>
<p>More specialized modules, e.g., Pulse Width signal output, Thermocouple input,
etc., extend from this general classification.</p>
<p>The I/O Framework is decomposed into layers. A bootstrap layer handles
configuration and setup of the environment using SDFs. A runtime layer provides
the hooks between the bootstrapped environment and the application development
environment. The framework is logically structured into a hardware abstract
layer e.g., an <em>IOModule</em> instance of digital output family, and a hardware
dependent layer, e.g., a vendor specific unit. Although the scope of the
currently envisioned framework is really targeted at EtherCAT, other technology
can be interfaced using the same architecture.</p>
</div></blockquote>
</div>
<div class="section" id="fieldbus-communication">
<h3>5.9.2. <em>Fieldbus Communication</em><a class="headerlink" href="#fieldbus-communication" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p><strong>EtherCAT Master</strong></p>
<blockquote>
<div><p>The principles of EtherCAT fieldbus communication are presented in more
details in Section on <a class="reference internal" href="../platform/platform.html#field-device-interface"><span class="std std-ref">Field Device Interface Technology</span></a>. The EtherCAT technology
group (ETG) provides an ANSI-C reference implementation for EtherCAT master.
The GMT I/O Framework relies on third party software to provide this
communication layer. Different commercial and open-source implementations
have been evaluated <a class="reference internal" href="../bibliography/bibliography.html#bec12a" id="id17">[Bec12a]</a> to find which solution better suited the needs
of GMT, and to understand commonalties between different solutions.</p>
<p>The current baseline uses the EtherCAT Master (ECM) from IgH, an open source
package from the IgH EtherLab tool suite. The IgH EtherCAT master is implemented
as a Linux kernel module and provides an API to configure and operate the
EtherCAT fieldbus. The API is available in user space and kernel space for
development.</p>
<p>The IgH implementation also provides a generic network driver that will function
independently of the computer network hardware, using the Linux kernel network
stack. This approach proves very flexible but suitable for rates typically less
than 1 kHz. Specialized drivers are also provided for a couple of popular
network interface (Intel e100/e1000, Broadcom). Those bypass the network stack
and allow faster and more deterministic responses, up to 5-10 kHz cycle time
from our lab evaluation.</p>
</div></blockquote>
<p><strong>ECM Driver</strong></p>
<blockquote>
<div><p>The IgH EtherCAT master handles all aspects of the communication protocol and
state transitions. Beyond that, it does not impose any particular philosophy
or mode of operation. The GMT I/O Framework builds on top of the EtherCAT
master to provide isolation from third-party specific implementations and a
common pattern reused by all the GMT applications.</p>
<p>The ECM Driver is the main component of the I/O framework; it provides the
following capabilities:</p>
<blockquote>
<div><ul class="simple">
<li>Interfaces with the EtherCAT master implementation and exposes a
predefined operation pattern.</li>
<li>Exposes status information via the <a class="reference external" href="http://en.wikipedia.org/wiki/Sysfs">sysfs</a> file system.</li>
<li>Exposes an API to configure the application process maps and I/O modules.
The interface is available from both user-space using <a class="reference external" href="http://en.wikipedia.org/wiki/Ioctl">ioctl</a> and kernel space.</li>
<li>Exposes a top level r/w debug level flag accessible through <a class="reference external" href="http://en.wikipedia.org/wiki/Procfs">procfs</a></li>
<li>Holds the field bus configuration in terms of I/O module terminals
topology and configuration.</li>
</ul>
</div></blockquote>
<p>The EtherCAT fieldbus communication follows a master/slaves paradigm. The
fieldbus is daisy chained and the protocol uses a simple addressing mechanism
based on each slave (i.e., I/O module terminal) position on the bus. The ECM
Driver component holds a list of <em>IOModules</em> to represent this arrangement.
IOModules are described in next section.</p>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="i-o-module-terminals">
<h3>5.9.3. <em>I/O Module Terminals</em><a class="headerlink" href="#i-o-module-terminals" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p><strong>EtherCAT Slaves</strong></p>
<blockquote>
<div><p>EtherCAT Slave Controllers (ESC) provide an EtherCAT Slave Information file
(ESI), an I/O module terminal description document in XML format. Information
about the module functionality and settings is provided by the ESI. Slave
specific information (manufacturer, product information, profile, object,
process data, sync or non-sync, sync manager setting) is registered to the ESI
file in XML format.</p>
<p>ESI files are used by the I/O Framework to define the application network
information (ENI) e.g., process data structures and initialization commands.
The ESI file is defined by the ETG.2000 EtherCAT Slave Information
specification. The structure of an ESI file is defined in the EtherCATInfo.xsd
XML schema document, available from ETG.2001 EtherCAT Slave Information
annotations.</p>
</div></blockquote>
<p><strong>ECG I/O Modules</strong></p>
<blockquote>
<div><p>An <em>IOModule</em> is a base component from the I/O framework used to represent an
EtherCAT slave controller. I/O Module terminals are fully resolved by their
vendor identifier, product code, and revision number. The ETG group assigns
EtherCAT technology partners and vendors unique vendor identifiers. The I/O
framework provides tools to automatically generate <em>IOModule</em> components from
the slaves ESI definition. The components follow a naming convention for
convenience.</p>
<p><em>IOModules</em> are registered to the ECM Driver using this naming convention and
their location on the fieldbus. They expose Process Data Object (PDO) as block
of memory. The I/O framework generates a mapping of the PDO map to different
target programing languages, currently C/C++ and Python.</p>
<p>The following code blocks below together show an example of an I/O Module PDO
Mapping in C/C++ and Python:</p>
<div class="literal-block-wrapper container" id="i-o-module-pdo-mapping-c-c">
<div class="code-block-caption"><span class="caption-number">Listing 2 </span><span class="caption-text">I/O Module PDO Mapping (C/C++)</span><a class="headerlink" href="#i-o-module-pdo-mapping-c-c" title="Permalink to this code">¶</a></div>
<div class="highlight-c++"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">bh_el7041_00130000_sm3</span> <span class="p">{</span>
    <span class="kt">uint8_t</span> <span class="nl">x1a01_6000_01</span> <span class="p">:</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// (ro) ENC Status - Status__Latch C valid</span>
    <span class="kt">uint8_t</span> <span class="nl">x1a01_6000_02</span> <span class="p">:</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// (ro) ENC Status - Status__Latch extern valid</span>
    <span class="kt">uint8_t</span> <span class="nl">x1a01_6000_03</span> <span class="p">:</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// (ro) ENC Status - Status__Set counter done</span>
    <span class="kt">uint8_t</span> <span class="nl">x1a01_6000_04</span> <span class="p">:</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// (ro) ENC Status - Status__Counter underflow</span>
    <span class="kt">uint8_t</span> <span class="nl">x1a01_6000_05</span> <span class="p">:</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// (ro) ENC Status - Status__Counter overflow</span>
    <span class="nl">uint8_t</span> <span class="p">:</span><span class="mi">2</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="nl">x1a01_6000_08</span> <span class="p">:</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// (ro) ENC Status - Status__Extrapolation stall</span>
    <span class="kt">uint8_t</span> <span class="nl">x1a01_6000_09</span> <span class="p">:</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// (ro) ENC Status - Status__Status of input A</span>
    <span class="p">...</span>
    <span class="kt">uint32_t</span> <span class="n">x1a06_6020_11</span><span class="p">;</span>   <span class="c1">// (ro) POS Status - Actual position</span>
    <span class="kt">int16_t</span> <span class="n">x1a06_6020_21</span><span class="p">;</span>    <span class="c1">// (ro) POS Status - Actual velocity</span>
    <span class="kt">uint32_t</span> <span class="n">x1a06_6020_22</span><span class="p">;</span>   <span class="c1">// (ro) POS Status - Actual drive time</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper container" id="i-o-module-pdo-mapping-python">
<div class="code-block-caption"><span class="caption-number">Listing 3 </span><span class="caption-text">I/O Module PDO Mapping (Python)</span><a class="headerlink" href="#i-o-module-pdo-mapping-python" title="Permalink to this code">¶</a></div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">bh_el7041_00130000_sm3</span> <span class="p">(</span><span class="n">Structure</span><span class="p">)</span> <span class="p">:</span>
  <span class="n">_pack_</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;x1a01_6000_01&#39;</span><span class="p">,</span> <span class="n">c_uint8</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="c1"># (ro) ENC Status - Status__Latch C valid</span>
    <span class="p">(</span><span class="s1">&#39;x1a01_6000_02&#39;</span><span class="p">,</span> <span class="n">c_uint8</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="c1"># (ro) ENC Status - Status__Latch extern valid</span>
    <span class="p">(</span><span class="s1">&#39;x1a01_6000_03&#39;</span><span class="p">,</span> <span class="n">c_uint8</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="c1"># (ro) ENC Status - Status__Set counter done</span>
    <span class="p">(</span><span class="s1">&#39;x1a01_6000_04&#39;</span><span class="p">,</span> <span class="n">c_uint8</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="c1"># (ro) ENC Status - Status__Counter underflow</span>
    <span class="p">(</span><span class="s1">&#39;x1a01_6000_05&#39;</span><span class="p">,</span> <span class="n">c_uint8</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="c1"># (ro) ENC Status - Status__Counter overflow</span>
    <span class="p">(</span><span class="s1">&#39;_________pad0&#39;</span><span class="p">,</span> <span class="n">c_uint8</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;x1a01_6000_08&#39;</span><span class="p">,</span> <span class="n">c_uint8</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="c1"># (ro) ENC Status - Status__Extrapolation stall</span>
    <span class="p">(</span><span class="s1">&#39;x1a01_6000_09&#39;</span><span class="p">,</span> <span class="n">c_uint8</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="c1"># (ro) ENC Status - Status__Status of input A</span>
    <span class="o">...</span>
    <span class="p">(</span><span class="s1">&#39;x1a06_6020_11&#39;</span><span class="p">,</span> <span class="n">c_uint32</span><span class="p">),</span>   <span class="c1"># (ro) POS Status - Actual position</span>
    <span class="p">(</span><span class="s1">&#39;x1a06_6020_21&#39;</span><span class="p">,</span> <span class="n">c_int16</span><span class="p">),</span>    <span class="c1"># (ro) POS Status - Actual velocity</span>
    <span class="p">(</span><span class="s1">&#39;x1a06_6020_22&#39;</span><span class="p">,</span> <span class="n">c_uint32</span><span class="p">),</span>   <span class="c1"># (ro) POS Status - Actual drive time</span>
  <span class="p">]</span>
</pre></div>
</div>
</div>
</div></blockquote>
<p>Once registered to the ECM Driver, each <em>IOModule</em> instance exposes status
information and its PDO mapping via the sysfs file system.</p>
<p>The Table below shows an ECG I/O Module sysfs (EL7041 at position 10):</p>
<table border="1" class="docutils" id="id38">
<caption><span class="caption-number">Table 30 </span><span class="caption-text">ECG I/O Module <em>sysfs</em> (EL7041 at position 10)</span><a class="headerlink" href="#id38" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="38%" />
<col width="11%" />
<col width="51%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">sysfs</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Type</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">iom/dev10_EL7041/al_state</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">int</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Application Layer state 0:INIT, 1:PREOP,</div>
<div class="line">2:SAFEOP, 3:OP)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">iom/dev10_EL7041online</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">int</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">IO Module online state</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">iom/dev10_EL7041operational</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">int</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">IO Module operational flag</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">iom/dev10_EL7041/1a01_6000_01</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">bit</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">(ro) ENC Status – Status Latch C valid</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">iom/dev10_EL7041/1a01_6000_02</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">bit</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">(ro) ENC Status – Status Latch extern valid</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="process-image">
<h3>5.9.4. <em>Process Image</em><a class="headerlink" href="#process-image" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p><strong>EtherCAT Frames</strong></p>
<blockquote>
<div>The ECM Driver handles the registration of all the <em>IOModules</em> and their
mapping into EtherCAT frames. EtherCAT frames are cyclically sent and
received by the master at the base frame rate defined by a “freq” parameter.
The I/O framework allows mapping of certain regions of the I/O modules at
multiple of the base rate, i.e., those PDO only update every n-th frames of
the nominal rate. The complete process image contained in the EtherCAT frame
can be thus split into separate logical regions.</div></blockquote>
<p><strong>ECM Domains</strong></p>
<blockquote>
<div><p>An ECM Domain is a base component of the I/O framework used to represent a
sub region of an EtherCAT frame updating at a given rate. The rate is a
fraction of the nominal rate and currently supports power of two values,
i.e., x1, x2, x4, ... x128. During system initialization, ECM Domains are
initially defined and <em>IOModules</em> register their PDO mapping into those
domains.</p>
<p>In its simplest form, an application may simply consist of a unique domain,
which will be used by all the modules and contains the complete process
image that updates at the nominal (x1) base rate. Once registered to the ECG
Master, each ECG Domain instance exposes status information and its fraction
of the process image via the sysfs file system.</p>
<p>The Table below shows an example of the Process Map sysfs:</p>
</div></blockquote>
<table border="1" class="docutils" id="id39">
<caption><span class="caption-number">Table 31 </span><span class="caption-text">Process Map <em>sysfs</em></span><a class="headerlink" href="#id39" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="30%" />
<col width="12%" />
<col width="58%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">sysfs</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>pmap/dom00/data</td>
<td>bytes[]</td>
<td>Domain process image memory map (mmap)</td>
</tr>
<tr class="row-odd"><td>pmap/dom00/domain_size</td>
<td>int</td>
<td>Number of bytes in data</td>
</tr>
<tr class="row-even"><td>pmap/dom00/wc_state</td>
<td>int</td>
<td>Working counter state (0: complete, 1: incomplete)</td>
</tr>
<tr class="row-odd"><td>pmap/dom00/working_counter</td>
<td>int</td>
<td>Working counter value</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="bootstrap-process">
<h3>5.9.5. <em>Bootstrap Process</em><a class="headerlink" href="#bootstrap-process" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>The framework provides all the capability to configure and bootstrap a new
application. The process can be done programmatically at different level:
kernel, user-space C/C++, python – in decreasing order of complexity.</p>
<p>The framework provides an API to configure Service Data Objects (SDO) and
Distributed Clock (DC) settings for each IO Module. Details are not presented
here but essentially consist of straightforward ioctl binding as listed in the
previous section. The resulting API provides seamless integration with the GMT
modeling framework and fosters the automatic generation of bootstrap components
based on model application definitions. Once bootstrapped, the I/O framework
cyclically runs the complete EtherCAT stack.</p>
<p>The code (Python) below shows an example of an Application Bootstrap:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gmt</span> <span class="kn">import</span> <span class="n">ecx</span>
<span class="kn">from</span> <span class="nn">gmt.ecx</span> <span class="kn">import</span> <span class="n">nth</span><span class="p">,</span> <span class="n">acc</span>

<span class="c1"># acquire master</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">ecx</span><span class="o">.</span><span class="n">master</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># register domains</span>
<span class="n">dinp</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">domain_register</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nth</span><span class="o">.</span><span class="n">x1</span><span class="p">,</span> <span class="n">acc</span><span class="o">.</span><span class="n">ro</span><span class="p">)</span>
<span class="n">dout</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">domain_register</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nth</span><span class="o">.</span><span class="n">x1</span><span class="p">,</span> <span class="n">acc</span><span class="o">.</span><span class="n">wo</span><span class="p">)</span>

<span class="c1"># register devices</span>
<span class="n">m</span><span class="o">.</span><span class="n">device_register</span><span class="p">(</span><span class="s1">&#39;bh_ek1100_00110000&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">device_register</span><span class="p">(</span><span class="s1">&#39;bh_el2202_00100000&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">device_register</span><span class="p">(</span><span class="s1">&#39;km_akd_00000002&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">inp</span> <span class="o">=</span> <span class="n">dinp</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">dout</span><span class="p">)</span>

<span class="c1"># activate @ 1 kHz</span>
<span class="n">m</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="runtime-components">
<h3>5.9.6. <em>Runtime Components</em><a class="headerlink" href="#runtime-components" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>The I/O framework provides additional runtime components to interface with the
bootstrapped application.</p>
<p><strong>ECM Fieldbus</strong></p>
<blockquote>
<div><p>The ECM Fieldbus component is a front end to the kernel spaces components. In
particular, ECM:</p>
<blockquote>
<div><ul class="simple">
<li>Runs the EtherCAT stack cyclically, taking over from the free-wheeling ECM
Driver.</li>
<li>Checks health of the different kernel components, e.g., ECM Driver link
up, slaves responding, I/OModule’s al_state, ECG domain’s working_counter,
etc. and raises appropriate alarms.</li>
<li>Arbitrates access to the process maps in between cycle.</li>
</ul>
</div></blockquote>
</div></blockquote>
<p><strong>ECM I/O Drivers</strong></p>
<blockquote>
<div><p>ECM I/O Drivers provide reference implementations for the control of their I/O
Modules. The I/O drivers interact with the ECM Driver to access the I/O module
process maps in a synchronized way. I/O Drivers can be very simple, e.g., a
digital output driver that only needs to set a bit in the I/O module process
map, or more involved, e.g., implement CiA402 motion profile state machine.</p>
<p>The ECG I/O Drivers essentially allow hiding the low level details of control,
and enforcing data synchronization when accessing the fieldbus.</p>
</div></blockquote>
<p><strong>BaseDeviceController</strong></p>
<blockquote>
<div><p>The BaseDeviceController component is part of the <a class="reference internal" href="#device-control-framework">device_control_framework</a>
and provides a base implementation for all GMT components implementing a
Device Controller. The components provide:</p>
<ul class="simple">
<li>An environment holding the <em>IOModules</em>, <em>IODrivers</em> and <em>Fieldbus</em>
instances, and access to those components.</li>
<li>Adapters to Observatory Services, e.g., logging, telemetry, alarms, etc..</li>
<li>Adapters to middleware to expose commands, process data, etc. to the rest of
the control system.</li>
</ul>
<p>The framework provides an API for developers to build their own application,
and python binding for rapid prototyping, testing, and validation.</p>
<p>The code (Python) below shows an example of an Application Runtime:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gmt</span> <span class="kn">import</span> <span class="n">ecx</span>

<span class="c1"># load application</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">ecx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">)</span>

<span class="c1"># lookup component</span>
<span class="n">km</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">lkup</span><span class="p">(</span><span class="s1">&#39;demo://dev/km_akd&#39;</span><span class="p">)</span>

<span class="c1"># device control</span>
<span class="k">def</span> <span class="nf">when_done</span><span class="p">(</span><span class="n">status</span><span class="p">):</span> <span class="k">pass</span>
<span class="n">km</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">km</span><span class="o">.</span><span class="n">datum</span><span class="p">()</span>
<span class="n">km</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="n">when_done</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../platform/platform.html" class="btn btn-neutral float-right" title="6. Platform" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../services/observatory_services.html" class="btn btn-neutral" title="4. Observatory Services" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, contributors.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0-rc1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>