

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Running Examples (TBR) &mdash; GMT Software And Controls documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="GMT Software And Controls documentation" href="index.html"/>
        <link rel="next" title="Creating a Device Control System (TBR)" href="dcs_dev_guide.html"/>
        <link rel="prev" title="Using the Services (TBR)" href="services.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> GMT Software And Controls
          

          
            
            <img src="_static/logo.jpg" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Developer Info and Release Configuration (TBR)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="services.html">Using the Services (TBR)</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">Running Examples (TBR)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#run-example-components">Run Example Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setup-component-ports">Setup Component Ports</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run-example-controller">Run Example Controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="#check-monitored-values">Check Monitored Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="#send-a-command-to-controller">Send a Command to Controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ethercat-example">Ethercat Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hdk-controller-with-ethercat-adapter">HDK Controller With Ethercat Adapter</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dcs_dev_guide.html">Creating a Device Control System (TBR)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contribute.html">Contribute</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">GMT Software And Controls</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Running Examples (TBR)</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/examples.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="running-examples-tbr">
<h1>Running Examples (TBR)<a class="headerlink" href="#running-examples-tbr" title="Permalink to this headline">¶</a></h1>
<div class="section" id="run-example-components">
<h2>Run Example Components<a class="headerlink" href="#run-example-components" title="Permalink to this headline">¶</a></h2>
<p>This example will start a set of c++ components from:</p>
<blockquote>
<div><em>src/runtime/src/obs_fwk/core_fwk/c++/examples/example_components</em></div></blockquote>
<p>The components will send some messages to the log service and they can be received by a log client.
Each component performs a simple operation on input and sends the result to outputs.
The components can be connected with each other if they receive a setup of ports. For example we can connect them this way:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>                     a1                  b1
     a2            +---+               +---+
   +---+           |   |&lt;--------------|   |
   |   |&lt;----------| + |               +---+
&lt;--| + |           |   |&lt;-------+
   |   |&lt;-----+    +---+        |        b2
   +---+      |                 |      +---+
              |                 +------|   |
              |                        +---+
              |
              |                          b3
              |                        +---+
              +------------------------|   |
                                       +---+
</pre></div>
</div>
</div>
<div class="section" id="setup-component-ports">
<h2>Setup Component Ports<a class="headerlink" href="#setup-component-ports" title="Permalink to this headline">¶</a></h2>
<p>At the beginning the ports of each component are not setup. Any component can receive their port setup as follows:</p>
<blockquote>
<div><em>Usage:</em>  <tt class="docutils literal"><span class="pre">setup_component</span>&nbsp; <span class="pre">subsystem_name</span>&nbsp; <span class="pre">component_name</span></tt></div></blockquote>
<p>This will look into:</p>
<blockquote>
<div><cite>${GMT_ROOT}/var/lib/gmt/cson/runtime/db/config/&lt;subsystem_name&gt;/&lt;component_name&gt;.cson</cite></div></blockquote>
<p>for the port setup.</p>
<p>For example, <em>component_A1</em> has the following configuration in:</p>
<blockquote>
<div><cite>${GMT_ROOT}/var/lib/gmt/cson/runtime/db/config/examples/component_A1.cson</cite></div></blockquote>
<div class="highlight-python"><div class="highlight"><pre><span></span>component_setup:
      name     : &#39;examples/component_A1&#39;
      port     : 8004
      host     : &#39;127.0.0.1&#39;
      rate     : &#39;1000000&#39;
      inputs   : [ [ &quot;x2&quot;, &quot;pull&quot;, &quot;tcp://127.0.0.1:9001&quot;, &quot;async&quot;, 1]
                   [ &quot;x3&quot;, &quot;pull&quot;, &quot;tcp://127.0.0.1:9002&quot;, &quot;async&quot;, 1] ]
      outputs  : [ [ &quot;x1&quot;, &quot;push&quot;, &quot;tcp://127.0.0.1:9004&quot;, &quot;async&quot;, 1] ]
</pre></div>
</div>
<p>To connect the example components as described in the previous section the following commands can be used:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ setup_component examples component_B1
$ setup_component examples component_B2
$ setup_component examples component_B3
$ setup_component examples component_A1
$ setup_component examples component_A2
</pre></div>
</div>
</div>
<div class="section" id="run-example-controller">
<h2>Run Example Controller<a class="headerlink" href="#run-example-controller" title="Permalink to this headline">¶</a></h2>
<p>A basic controller with a temperature state variable is provided at:</p>
<blockquote>
<div><cite>src/runtime/src/obs_fwk/ctrl_fwk/c++/examples/basic_controller</cite></div></blockquote>
<p>The configuration for this controller is:</p>
<blockquote>
<div><cite>${GMT_ROOT}/var/lib/gmt/cson/runtime/db/config/examples/basic_controller.cson</cite></div></blockquote>
<div class="highlight-python"><div class="highlight"><pre><span></span>component_setup:
    name     : &#39;examples/basic_controller&#39;
    port     : 8001
    host     : &#39;127.0.0.1&#39;
    rate     : &#39;1000000&#39;
    inputs   : [ [ &#39;temperature_setpoint&#39;, &#39;pull&#39;, &#39;tcp://127.0.0.1:9001&#39;, &#39;async&#39;, 1] ]
    outputs  : [ [ &#39;temperature_monitor&#39;,  &#39;push&#39;, &#39;tcp://127.0.0.1:9011&#39;, &#39;async&#39;, 1000] ]
state_vars:
    temperature: { type: &#39;float&#39;, init: 23.4, min: 2.0, max: 26.1, url: &#39;tcp://127.0.0.1:9011&#39; }
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ run_basic_controller <span class="p">&amp;</span>
$ setup_component examples basic_controller
</pre></div>
</div>
</div>
<div class="section" id="check-monitored-values">
<h2>Check Monitored Values<a class="headerlink" href="#check-monitored-values" title="Permalink to this headline">¶</a></h2>
<p>Telemetry is a distributed service than can be started independently on each component as:</p>
<blockquote>
<div><em>Usage:</em>  <tt class="docutils literal"><span class="pre">monitor_component</span>&nbsp; <span class="pre">subsystem_name</span>&nbsp; <span class="pre">component_name</span></tt></div></blockquote>
<p>This command will start the telemetry adapters for this component and they will send monitored values to the server.
The telemetry service will:</p>
<ul class="simple">
<li>store data points in the database</li>
<li>send the values to subscribers</li>
<li>accept queries from clients</li>
</ul>
<p>Note that monitors are the values of the state variables defined in the controller (state_var section).</p>
<p>For example, the following command will start sending &#8216;temperature&#8217; data points to the telemetry service.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ monitor_component examples basic_controller
</pre></div>
</div>
<p>To check the monitored values a telemetry_client can be started in another unix terminal:</p>
<blockquote>
<div><em>Usage:</em>  <tt class="docutils literal"><span class="pre">telemetry_client</span> <span class="pre">[topic]</span></tt></div></blockquote>
<p>A query can also be sent to the telemetry service like this:</p>
<blockquote>
<div><em>Usage:</em>  <tt class="docutils literal"><span class="pre">telemetry_query</span>&nbsp; <span class="pre">monitor_name</span>&nbsp; <span class="pre">num</span></tt></div></blockquote>
<p>For example, the following will list the last 12 temperature values (from newest to oldest) from this controller:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ telemetry_query examples.basic_controller.temperature 12
</pre></div>
</div>
<p>All telemetry queries have to be done on specific monitors.</p>
</div>
<div class="section" id="send-a-command-to-controller">
<h2>Send a Command to Controller<a class="headerlink" href="#send-a-command-to-controller" title="Permalink to this headline">¶</a></h2>
<p>Some numeric values can be sent directly to ports of any controller like this:</p>
<blockquote>
<div><em>Usage:</em>  <tt class="docutils literal"><span class="pre">send_value</span> <span class="pre">subsystem</span>&nbsp; <span class="pre">controller</span>&nbsp; <span class="pre">port_name</span> <span class="pre">value</span> <span class="pre">{</span> <span class="pre">int</span> <span class="pre">|</span> <span class="pre">float</span> <span class="pre">}</span></tt></div></blockquote>
<p>For example:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ send_value examples basic_controller temperature_setpoint 23.3 float
</pre></div>
</div>
<p>This will send a temperature setpoint of 23.3 to the controller which should react to this change.
State var values shall change on the telemetry client.
When the temperature values are out the the defined range the log client should show the corresponding warning messages.</p>
</div>
<div class="section" id="ethercat-example">
<h2>Ethercat Example<a class="headerlink" href="#ethercat-example" title="Permalink to this headline">¶</a></h2>
<p>Keep the log_client and the telemetry_client open in different terminals.</p>
<p>This will start and setup the example ethercat adapter:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ run_ethercat_example <span class="p">&amp;</span>
$ setup_component examples ethercat_example
</pre></div>
</div>
<p>To send the ethercat configuration to and EtherCAT Hw Adapter use the following command:</p>
<blockquote>
<div><em>Usage:</em>  <tt class="docutils literal"><span class="pre">ethercat_config</span>&nbsp; <span class="pre">subsystem_name</span>&nbsp; <span class="pre">ethercat_adapter</span>&nbsp; <span class="pre">configuration</span></tt></div></blockquote>
<p>For example, the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ ethercat_config examples ethercat_example ethercat_config
</pre></div>
</div>
<p>will send the bus configuration defined in:</p>
<blockquote>
<div><cite>${GMT_ROOT}/var/lib/gmt/cson/runtime/db/config/examples/ethercat_config.cson</cite> bus config</div></blockquote>
<p>to the &#8216;ecat_config&#8217; port of the adapter.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last">
<li><p class="first">All EtherCAT adapters need an &#8216;ecat_config&#8217; port in the their setup</p>
</li>
<li><p class="first">Default EtherCAT objects defined at:</p>
<blockquote>
<div><p><cite>${GMT_ROOT}/var/lib/gmt/cson/runtime/db/config/ethercat/ethercat_example.cson</cite></p>
</div></blockquote>
</li>
<li><p class="first">Ethercat config is still not included and generated from the model</p>
</li>
</ul>
</div>
</div>
<div class="section" id="hdk-controller-with-ethercat-adapter">
<h2>HDK Controller With Ethercat Adapter<a class="headerlink" href="#hdk-controller-with-ethercat-adapter" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ run_hdk_controller <span class="p">&amp;</span>
$ setup_component hdk_cs hw_adapter
$ ethercat_config hdk_cs hw_adapter
$ setup_component hdk_cs controller
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="dcs_dev_guide.html" class="btn btn-neutral float-right" title="Creating a Device Control System (TBR)" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="services.html" class="btn btn-neutral" title="Using the Services (TBR)" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, contributors.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0-rc1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>